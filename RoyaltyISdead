if _G.LinoriaGui then
    _G.LinoriaGui:Destroy()
    _G.LinoriaGui = nil
end

local repo = "https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/"
local Library = loadstring(game:HttpGet(repo.."Library.lua"))()
local Theme = loadstring(game:HttpGet(repo.."addons/ThemeManager.lua"))()
local Save = loadstring(game:HttpGet(repo.."addons/SaveManager.lua"))()

local W = Library:CreateWindow({Title="Rise to Destruction - By Demon8989_19",Center=true,AutoShow=true})
_G.LinoriaGui = Library.ScreenGui

local T = W:AddTab("Main")
local F = T:AddLeftGroupbox("Food")
local D = T:AddLeftGroupbox("Drinks")
local S = T:AddLeftGroupbox("Desserts")

local Rtab = W:AddTab("Resources")
local ResGB = Rtab:AddLeftGroupbox("Resources")
local MedGB = Rtab:AddLeftGroupbox("Medicine")

local ToolTab = W:AddTab("Tools")
local X = ToolTab:AddLeftGroupbox("Tools")
local ExtraGB = ToolTab:AddLeftGroupbox("Extra")

F:AddButton("Cinnamon Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Cinnamon Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
F:AddButton("Cooked Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Cooked Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
F:AddButton("Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

D:AddButton("Grape Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Grape Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
D:AddButton("Orange Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Orange Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
D:AddButton("Apple Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Apple Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

S:AddButton("Tart",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Tart"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Pie",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Pie"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Red Velvet Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Red Velvet Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Strawberry Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Strawberry Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Chocolate Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Chocolate Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

ResGB:AddButton("Powder",function()
    local args={workspace.World.Interactables.Stores.ResourceStall,"Powder"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
ResGB:AddButton("Mint",function()
    local args={workspace.World.Interactables.Stores.ResourceStall,"Mint"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

MedGB:AddButton("Saffron",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Saffron"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
MedGB:AddButton("Honey",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Honey"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
MedGB:AddButton("Tea",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Tea"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

X:AddButton("Instant Prompt",function()
    local function I(p) if p:IsA("ProximityPrompt") then p.HoldDuration=0 end end
    for _,v in pairs(game:GetDescendants()) do I(v) end
    game.DescendantAdded:Connect(I)
end)

X:AddButton("Infinite Yield",function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source',true))()
end)

X:AddButton("Clear UIs",function()
    local player=game:GetService("Players").LocalPlayer
    local playerGui=player.PlayerGui
    local mainGui=playerGui:FindFirstChild("Main")
    if mainGui then
        local essentials=mainGui:FindFirstChild("Essentials")
        if essentials then
            local conditions=essentials:FindFirstChild("Conditions")
            if conditions then conditions.Visible=false end
            local laws=essentials:FindFirstChild("Laws")
            if laws then laws.Visible=false end
        end
        local roles=mainGui:FindFirstChild("Roles")
        if roles then roles.Visible=false end
        local events=mainGui:FindFirstChild("Events")
        if events then events.Visible=false end
        local shopMain=mainGui:FindFirstChild("Shop") and mainGui.Shop:FindFirstChild("Main")
        if shopMain then shopMain.Visible=false end
        local report=mainGui:FindFirstChild("Report")
        if report then report.Visible=false end
    end
end)

ExtraGB:AddButton("Animations",function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/Emerson2-creator/Scripts-Roblox/refs/heads/main/ScriptR6/AnimGuiV2.lua'))()
end)

-- Instant Deliver Gifts Handler
local RosalinaTab=W:AddTab("Rosalina")
local RosiGB=RosalinaTab:AddLeftGroupbox("Rosalina UI")
RosiGB:AddButton("Rosalina UI",function()
    local player=game:GetService("Players").LocalPlayer
    local gui=player.PlayerGui:WaitForChild("Main"):WaitForChild("Interactions"):WaitForChild("Rosaline")
    if gui then gui.Visible=true end
end)

RosiGB:AddToggle('FindRosaline',{Text='Find Rosaline',Default=false,Tooltip='Toggle highlight on Rosaline'}):OnChanged(function(value)
    local npc=workspace:WaitForChild("World"):WaitForChild("Interactables"):WaitForChild("SpecialNPCs"):WaitForChild("Rosaline")
    local existing=npc:FindFirstChild("RosalineHighlight")
    if value then
        if not existing then
            local h=Instance.new("Highlight")
            h.Name="RosalineHighlight";h.Adornee=npc;h.FillColor=Color3.fromRGB(255,0,0)
            h.OutlineColor=Color3.fromRGB(255,255,255);h.FillTransparency=0.5;h.OutlineTransparency=0
            h.Parent=npc
        end
    else
        if existing then existing:Destroy() end
    end
end)

RosiGB:AddButton("Instant Deliver Gifts!",function()
    local args={"ReputationGift"}
    game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Knit")
        :WaitForChild("Services"):WaitForChild("NPCService"):WaitForChild("RE"):WaitForChild("Event")
        :FireServer(unpack(args))
end)

-- UI Settings Tab (moved to end)
Theme:SetLibrary(Library)
Theme:ApplyToTab(W:AddTab("UI Settings"))

Save:SetLibrary(Library)
Save:ApplyToWindow(W)
