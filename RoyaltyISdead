if _G.LinoriaGui then
    _G.LinoriaGui:Destroy()
    _G.LinoriaGui = nil
end

local repo = "https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/"
local Library = loadstring(game:HttpGet(repo.."Library.lua"))()
local Theme = loadstring(game:HttpGet(repo.."addons/ThemeManager.lua"))()
local Save = loadstring(game:HttpGet(repo.."addons/SaveManager.lua"))()

local W = Library:CreateWindow({Title="Rise to Destruction - By Demon8989_19",Center=true,AutoShow=true})
_G.LinoriaGui = Library.ScreenGui

-- Main Tab
local T = W:AddTab("Main")
local F = T:AddLeftGroupbox("Food")
local D = T:AddLeftGroupbox("Drinks")
local S = T:AddLeftGroupbox("Desserts")

-- Resources Tab
local Rtab = W:AddTab("Resources")
local ResGB = Rtab:AddLeftGroupbox("Resources")
local MedGB = Rtab:AddLeftGroupbox("Medicine")

-- Tools Tab
local ToolTab = W:AddTab("Tools")
local X = ToolTab:AddLeftGroupbox("Tools")
local ExtraGB = ToolTab:AddLeftGroupbox("Extra")

-- Food Buttons
F:AddButton("Cinnamon Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Cinnamon Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
F:AddButton("Cooked Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Cooked Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
F:AddButton("Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Drink Buttons
D:AddButton("Grape Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Grape Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
D:AddButton("Orange Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Orange Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
D:AddButton("Apple Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Apple Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Dessert Buttons
S:AddButton("Tart",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Tart"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Pie",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Pie"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Red Velvet Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Red Velvet Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Strawberry Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Strawberry Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Chocolate Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Chocolate Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Resources Buttons
ResGB:AddButton("Powder",function()
    local args={workspace.World.Interactables.Stores.ResourceStall,"Powder"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
ResGB:AddButton("Mint",function()
    local args={workspace.World.Interactables.Stores.ResourceStall,"Mint"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Medicine Buttons
MedGB:AddButton("Saffron",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Saffron"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
MedGB:AddButton("Honey",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Honey"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
MedGB:AddButton("Tea",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Tea"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Tool Buttons
X:AddButton("Instant Prompt",function()
    for _,v in pairs(game:GetDescendants()) do
        if v:IsA("ProximityPrompt") then v.HoldDuration = 0 end
    end
    game.DescendantAdded:Connect(function(v) if v:IsA("ProximityPrompt") then v.HoldDuration = 0 end end)
end)
X:AddButton("Infinite Yield",function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source',true))()
end)
X:AddButton("Clear UIs",function()
    local player = game.Players.LocalPlayer
    local mainGui = player.PlayerGui:FindFirstChild("Main")
    if mainGui then
        for _,path in ipairs({"Essentials/Conditions","Essentials/Laws","Roles","Events","Shop/Main","Report"}) do
            local obj = mainGui:FindFirstChild(path:match("^[^/]+"))
            for _,sub in ipairs(path:split("/")) do if obj then obj = obj:FindFirstChild(sub) end end
            if obj then obj.Visible = false end
        end
    end
end)

ExtraGB:AddButton("Animations",function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/Emerson2-creator/Scripts-Roblox/refs/heads/main/ScriptR6/AnimGuiV2.lua'))()
end)

-- Rosalina Tab
local RosalinaTab = W:AddTab("Rosalina")
local RosiGB = RosalinaTab:AddLeftGroupbox("Rosalina UI")
RosiGB:AddButton("Rosalina UI",function()
    local gui = game.Players.LocalPlayer.PlayerGui:WaitForChild("Main"):WaitForChild("Interactions"):WaitForChild("Rosaline")
    if gui then gui.Visible = true end
end)
RosiGB:AddToggle('FindRosaline',{Text='Find Rosaline',Default=false}):OnChanged(function(val)
    local npc = workspace.World.Interactables.SpecialNPCs.Rosaline
    local existing = npc:FindFirstChild("RosalineHighlight")
    if val then
        if not existing then
            local h = Instance.new("Highlight",npc)
            h.Name = "RosalineHighlight" h.Adornee = npc
            h.FillColor = Color3.fromRGB(255,0,0) h.OutlineColor = Color3.fromRGB(255,255,255)
            h.FillTransparency = 0.5 h.OutlineTransparency = 0
        end
    else
        if existing then existing:Destroy() end
    end
end)
RosiGB:AddButton("Instant Deliver Gifts!",function()
    game.ReplicatedStorage.Packages.Knit.Services.NPCService.RE.Event:FireServer("ReputationGift")
end)

-- ESP Tab
local EspTab = W:AddTab("ESP")
local E = EspTab:AddLeftGroupbox("Team ESP")
local Teams = {"Monarch","Viceroy","Heir","Noble","Commander","Knight","Servant","Herbalist","Grand Sage","Sage","Citizen","Peasant"}
for _,teamName in ipairs(Teams) do
    E:AddToggle(teamName.."ESP",{Text=teamName.." ESP",Default=false}):OnChanged(function(enabled)
        for _,plr in ipairs(game.Players:GetPlayers()) do
            local char = plr.Character
            if char then
                local tag = char:FindFirstChild(teamName.."ESP")
                local isTeam = (plr.Team and plr.Team.Name == teamName)
                if enabled and isTeam then
                    if not tag then
                        local h = Instance.new("Highlight",char)
                        h.Name = teamName.."ESP"
                        h.Adornee = char
                        h.FillColor = plr.TeamColor.Color
                        h.OutlineColor = plr.TeamColor.Color
                    end
                elseif tag then
                    tag:Destroy()
                end
            end
        end
    end)
end

-- UI Settings
Theme:SetLibrary(Library)
Theme:ApplyToTab(W:AddTab("UI Settings"))
Save:SetLibrary(Library)
Save:ApplyToWindow(W)
