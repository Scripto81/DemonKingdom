if _G.LinoriaGui then
    _G.LinoriaGui:Destroy()
    _G.LinoriaGui = nil
end

local repo    = "https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/"
local Library = loadstring(game:HttpGet(repo.."Library.lua"))()
local Theme  = loadstring(game:HttpGet(repo.."addons/ThemeManager.lua"))()
local Save   = loadstring(game:HttpGet(repo.."addons/SaveManager.lua"))()

local W      = Library:CreateWindow({Title="Rise to Royalty",Center=true,AutoShow=true})
_G.LinoriaGui = Library.ScreenGui

Theme:SetLibrary(Library)
Theme:ApplyToTab(W:AddTab("UI Settings"))

local T      = W:AddTab("Main")
local F      = T:AddLeftGroupbox("Food")
local D      = T:AddLeftGroupbox("Drinks")
local S      = T:AddLeftGroupbox("Desserts")
local R      = W:AddTab("Resources")               -- new Resources tab
local ResGB  = R:AddLeftGroupbox("Resources")      -- Powder & Mint
local MedGB  = R:AddLeftGroupbox("Medicine")       -- Saffron, Honey, Tea
local X      = T:AddLeftGroupbox("Tools")

-- Food
F:AddButton("Cinnamon Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Cinnamon Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
F:AddButton("Cooked Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Cooked Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
F:AddButton("Bread",function()
    local args={workspace.World.Interactables.Stores.BreadStall,"Bread"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Drinks
D:AddButton("Grape Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Grape Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
D:AddButton("Orange Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Orange Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
D:AddButton("Apple Juice",function()
    local args={workspace.World.Interactables.Stores.DrinkStall,"Apple Juice"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Desserts
S:AddButton("Tart",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Tart"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Pie",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Pie"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Red Velvet Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Red Velvet Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Strawberry Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Strawberry Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
S:AddButton("Chocolate Cake",function()
    local args={workspace.World.Interactables.Stores.DessertStall,"Chocolate Cake"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Resources
ResGB:AddButton("Powder",function()
    local args={workspace.World.Interactables.Stores.ResourceStall,"Powder"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
ResGB:AddButton("Mint",function()
    local args={workspace.World.Interactables.Stores.ResourceStall,"Mint"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Medicine
MedGB:AddButton("Saffron",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Saffron"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
MedGB:AddButton("Honey",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Honey"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)
MedGB:AddButton("Tea",function()
    local args={workspace.World.Interactables.Stores.MedicineStall,"Tea"}
    game.ReplicatedStorage.Packages.Knit.Services.StallService.RE.Event:FireServer(unpack(args))
end)

-- Tools
X:AddButton("Instant Prompt",function()
    local function I(p) if p:IsA("ProximityPrompt") then p.HoldDuration=0 end end
    for _,v in pairs(game:GetDescendants()) do I(v) end
    game.DescendantAdded:Connect(I)
end)

Save:SetLibrary(Library)
Save:ApplyToWindow(W)
